<html>
	<head lang="pl">
		<meta charset="utf-8">
		<link href="metro-all.min.css" rel="stylesheet" type="text/css">
		<link href="style.css" rel="stylesheet" type="text/css">
		<script src="nui://game/ui/jquery.js" type="text/javascript"></script>
	</head>
	<body>
		<div id="lscm_tablet">
			<div class="content">
				<div id="loader">
					<div class="loader-content">
						<div data-role="activity" data-type="ring" data-style="color"></div>
					</div>
				</div>
				<div class="window">
					<div class="window-caption bg-orange">
						<span class="icon mif-wrench"></span>
						<span class="title"><b>LSCM</b> | System zarządzania</span>
						<div class="buttons">
							<span class="btn-min"></span>
							<span class="btn-max"></span>
							<span class="btn-close"></span>
						</div>
					</div>
					<nav data-role="ribbonmenu" data-role-ribbonmenu="true" class="ribbon-menu">
						<div class="content-holder">
							<div class="section active">
								<div class="group">
									<button class="ribbon-button" id="lscm_tab_home">
										<span class="icon">
											<span class="mif-home mif-5x"></span>
										</span>
										<span class="caption">Strona główna</span>
									</button>
									<div class="group-divider"></div>
									<button class="ribbon-button" id="lscm_tab_history">
										<span class="icon">
											<span class="mif-assignment mif-5x"></span>
										</span>
										<span class="caption">Historia napraw</span>
									</button>
									<button class="ribbon-button" id="lscm_tab_invoice">
										<span class="icon">
											<span class="mif-pencil mif-5x"></span>
										</span>
										<span class="caption">Wystaw fakturę</span>
									</button>
									<button class="ribbon-button" id="lscm_tab_assistance">
										<span class="icon">
											<span class="mif-security mif-5x"></span>
										</span>
										<span class="caption">Sprawdź ubezpieczenie</span>
									</button>
									<span class="title" id="lscm_tab_active">Strona główna</span>
								</div>
							</div>
						</div>
					</nav>
					<div id="lscm_tab_home_content">
						<div class="window-content p-2">
							<div class="row">
								<div class="cell-md-4">
									<div class="social-box">
										<div class="header bg-orange fg-white m-0">
											<div class="title" id="lscm_tab_home_content_name">-</div>
											<div class="subtitle" id="lscm_tab_home_content_jobgrade">-</div>
										</div>
										<ul class="skills" style="padding:0;">
											<li>
												<div class="text-bold" id="lscm_tab_home_content_lscmonline">-</div>
												<div>DOSTĘPNI MECHANICY</div>
											</li>
											<li>
												<div class="text-bold" id="lscm_tab_home_content_invoices">-</div>
												<div>WYSTAWIONE FAKTURY</div>
											</li>
										</ul>
									</div>
								</div>
								<div class="cell-md-8">
									<iframe src="https://gta-5-map.com/" style="width:100%;height:410px;"></iframe>
								</div>
							</div>
						</div>
					</div>
					<div id="lscm_tab_invoice_content" style="display:none;">
						<div class="window-content p-2">
							<div class="row">
								<div class="cell-md-6">
									<form>
										<div class="form-group">
											<label>Imię i nazwisko</label>
											<div class="row">
												<div class="cell-md-6">
													<input type="text" placeholder="Imię" id="lscm_invoice_name">
												</div>
												<div class="cell-md-6">
													<input type="text" placeholder="Nazwisko" id="lscm_invoice_surname">
												</div>
											</div>
										</div>
										<div class="form-group">
											<label>Rodzaj naprawy</label>
											<input type="text" placeholder="Rodzaj naprawy" id="lscm_invoice_treatment">
										</div>
										<div class="row">
											<div class="cell-md-4">
												<div class="form-group">
													<label>Kwota</label>
													<input type="text" placeholder="Kwota" data-role="input" data-append="<span class='mif-dollar2'></span>" id="lscm_invoice_price">
												</div>
											</div>
											<div class="cell-md-4">
												<div class="form-group">
													<label>Data</label>
													<input type="text" placeholder="" disabled id="lscm_invoice_date">
												</div>
											</div>
										</div>
										<div class="form-group">
											<button type="submit" class="button primary" id="lscm_invoice_submit">Wystaw fakturę</button>
										</div>
										<p id="lscm_invoice_alert"></p>
									</form>
								</div>
								<div class="cell-md-6">
									<h4>Podsumowanie:</h4>
									<b>Imię:</b> <span id="lscm_summary_name">-</span><br>
									<b>Nazwisko:</b> <span id="lscm_summary_surname">-</span><br>
									<b>Rodzaj naprawy:</b> <span id="lscm_summary_treatment">-</span><br>
									<b>Kwota:</b> <span id="lscm_summary_price">-</span>$<br><br>
									<b>Docelowy najbliższy gracz:</b> <span id="lscm_summary_target">-</span>
								</div>
							</div>
						</div>
					</div>
					<div id="lscm_tab_history_content" style="display:none;">
						<div class="window-content p-2">
							<div class="row mb-2">
								<div class="cell-md-11 my-search-wrapper"></div>
								<div class="cell-md-1 my-rows-wrapper"></div>
							</div>
							<table class="table striped table-border"
								data-role="table"
								data-show-search="true"
								data-search-min-length="3"
								data-search-threshold="300"
								data-search-fields="name,surname"
								data-table-search-title="Wyszukaj:"
								data-table-rows-count-title=""
								data-table-info-title="Ilość rekordów: <b>$3</b>"
								data-pagination-prev-title="Wstecz"
								data-pagination-next-title="Dalej"
								data-search-wrapper=".my-search-wrapper"
								data-rows-wrapper=".my-rows-wrapper"
								data-rownum="true"
								id="lscm_tab_history_table">
								<thead>
									<tr>
										<th data-name="name">Imię</th>
										<th data-name="surname">Nazwisko</th>
										<th>Rodzaj naprawy</th>
										<th>Ubezpieczenie</th>
										<th>Data</th>
										<th>Mechanik</th>
									</tr>
								</thead>
								<tbody>
								</tbody>
							</table>
						</div>
					</div>
					<div id="lscm_tab_assistance_content" style="display:none;">
						<div class="window-content p-2">
							<div class="row">
								<div class="cell-md-6">
									<div class="form-group">
										<label>Imię i nazwisko</label>
										<input type="text" placeholder="Imię i nazwisko" id="lscm_assistance_name">
									</div>
									<div class="form-group">
										<button class="button primary" id="lscm_assistance_submit">Sprawdź</button>
									</div>
								</div>
								<div class="cell-md-6">
									<table class="table striped table-border"
										data-role="table"
										data-show-search="false"
										data-search-min-length="3"
										data-search-threshold="300"
										data-table-rows-count-title=""
										data-table-info-title="Ilość rekordów: <b>$3</b>"
										data-pagination-prev-title="Wstecz"
										data-pagination-next-title="Dalej"
										data-rownum="false"
										id="lscm_assistance_result">
										<thead>
											<tr>
												<th data-name="name">Imię</th>
												<th data-name="surname">Nazwisko</th>
												<th>Ubezpieczenie</th>
											</tr>
										</thead>
										<tbody>
										</tbody>
									</table>
								</div>
							</div>
						</div>
					</div>
					<p id="lscm_date" class="m-0 text-center"></p>
				</div>
			</div>
		</div>
		<script src="metro.min.js" type="text/javascript"></script>
		<script>
			function getDate(){
				var today = new Date();
				var hh = String(today.getHours());
				var ii = String(today.getMinutes()).padStart(2, '0');
				var dd = String(today.getDate()).padStart(2, '0');
				var mm = String(today.getMonth() + 1).padStart(2, '0');
				var yyyy = today.getFullYear();
				today = dd + '.' + mm + '.' + yyyy + ', ' + hh + ':' + ii;
				return today;
			}
			document.getElementById('lscm_date').innerHTML = getDate();
		</script>
		<script>
			$("#lscm_tab_home").click(function(){
				changeTab(1);
			});
			$("#lscm_tab_invoice").click(function(){
				changeTab(2);
				$("#lscm_invoice_date").attr("placeholder", getDate());
				$.post('http://fx_lscm_tablet/getInvoiceTarget', JSON.stringify({}));
			});
			$("#lscm_tab_history").click(function(){
				changeTab(3);
				clearHistoryTable();
				$.post('http://fx_lscm_tablet/getHistory', JSON.stringify({}));
			});
			$("#lscm_tab_assistance").click(function(){
				changeTab(4);
				clearAssistanceResultTable();
			});
			function changeTab(n){
				$("#loader").fadeIn(500, function(){
					switch(n){
						case 1:
							$("#lscm_tab_active").html("Strona główna");
							$("#lscm_tab_home_content").show();
							$("#lscm_tab_invoice_content").hide();
							$("#lscm_tab_history_content").hide();
							$("#lscm_tab_bed_content").hide();
							$("#lscm_tab_assistance_content").hide();
							break;
						case 2:
							$("#lscm_tab_active").html("Wystaw fakturę");
							$("#lscm_tab_home_content").hide();
							$("#lscm_tab_invoice_content").show();
							$("#lscm_tab_history_content").hide();
							$("#lscm_tab_bed_content").hide();
							$("#lscm_tab_assistance_content").hide();
							break;
						case 3:
							$("#lscm_tab_active").html("Historia napraw");
							$("#lscm_tab_home_content").hide();
							$("#lscm_tab_invoice_content").hide();
							$("#lscm_tab_history_content").show();
							$("#lscm_tab_bed_content").hide();
							$("#lscm_tab_assistance_content").hide();
							break;
						case 4:
							$("#lscm_tab_active").html("Sprawdź ubezpieczenie");
							$("#lscm_tab_home_content").hide();
							$("#lscm_tab_invoice_content").hide();
							$("#lscm_tab_history_content").hide();
							$("#lscm_tab_bed_content").hide();
							$("#lscm_tab_assistance_content").show();
							break;
					}
					setTimeout(function(){$("#loader").fadeOut(500)}, 1500);
				});
			}

			$("#lscm_invoice_name").on("input", function(){
				$("#lscm_summary_name").html(this.value)
			});
			$("#lscm_invoice_surname").on("input", function(){
				$("#lscm_summary_surname").html(this.value)
			});
			$("#lscm_invoice_price").on("input", function(){
				$("#lscm_summary_price").html(this.value)
			});
			$("#lscm_invoice_treatment").on("input", function(){
				$("#lscm_summary_treatment").html(this.value)
			});
			$("#lscm_invoice_submit").click(function(){
				var name = $("#lscm_invoice_name");
				var surname = $("#lscm_invoice_surname");
				var treatment = $("#lscm_invoice_treatment");
				var price = $("#lscm_invoice_price");
				if(name.val() != ""){
					if(surname.val() != ""){
						if(treatment.val() != ""){
							if(price.val() != "" && !isNaN(price.val())){
								$.post('http://fx_lscm_tablet/NUIFocusOff', JSON.stringify({}));
								$.post('http://fx_lscm_tablet/createInvoice', JSON.stringify({
									name: name.val(),
									surname: surname.val(),
									treatment: treatment.val(),
									price: price.val(),
									date: getDate()
								}));
							}
						}
					}
				}
			});

			$("#lscm_assistance_submit").click(function(){
				var name = $("#lscm_assistance_name");
				if(name.val() != ""){
					clearAssistanceResultTable();
					$.post('http://fx_lscm_tablet/loadUserAssistance', JSON.stringify({
						name: name.val()
					}));
				}
			});

			// Event handler
			window.addEventListener('message', function(event){
				if(event.data.type == "open"){
					$('#lscm_tablet').css('display', 'flex');
					$('body').css('display', 'block');
				}else if(event.data.type == "close"){
					$('#lscm_tablet').css('display', 'none');
					$('body').css('display', 'none');
				}else if(event.data.type == "loadHistory"){
					var data = [event.data.name, event.data.surname, event.data.treatment, event.data.assistance, event.data.date, event.data.doctor];
					var table = Metro.getPlugin("#lscm_tab_history_table", "table");
					table.addItem(data, true);
				}else if(event.data.type == "loadInvoiceTarget"){
					if(event.data.target){
						$("#lscm_summary_target").html(event.data.name + " " + event.data.surname + " (" + event.data.id + ")");
						$("#lscm_invoice_alert").html("");
						$("#lscm_invoice_submit").css('display', 'block');
					}else{
						$("#lscm_invoice_alert").html("Docelowy najbliższy gracz nie jest określony! Podejdź bliżej do gracza!");
						$("#lscm_invoice_submit").css('display', 'none');
					}
				}else if(event.data.type == "loadDefaultData"){
					$("#lscm_tab_home_content_name").html(event.data.name);
					$("#lscm_tab_home_content_jobgrade").html(event.data.jobgrade);
					$("#lscm_tab_home_content_lscmonline").html(event.data.lscmonline);
					$("#lscm_tab_home_content_invoices").html(event.data.invoices);
				}else if(event.data.type == "loadUserAssistance"){
					var data = [event.data.name, event.data.surname, event.data.assistance];
					var table = Metro.getPlugin("#lscm_assistance_result", "table");
					table.addItem(data, true);
				}
			});

			// Clear history table data
			function clearHistoryTable(){
				var table = Metro.getPlugin("#lscm_tab_history_table", "table");
				table.items = [];
				table.draw();
			}

			// Clear assistance result table data
			function clearAssistanceResultTable(){
				var table = Metro.getPlugin("#lscm_assistance_result", "table");
				table.items = [];
				table.draw();
			}

			// Close tablet control
			document.onkeyup = function(data){
				if(data.which == 27){
					$('#lscm_tablet').css('display', 'none');
					$('body').css('display', 'none');
					$.post('http://fx_lscm_tablet/NUIFocusOff', JSON.stringify({}));
				}
			}
			$(".btn-close").click(function(){
				$('#lscm_tablet').css('display', 'none');
				$('body').css('display', 'none');
				$.post('http://fx_lscm_tablet/NUIFocusOff', JSON.stringify({}));
			});
		</script>
	</body>
</html>